version: 2

models:


  - name: dim_date
    description: a dimensional table for our date dimension.
    columns:
      - name: date_key
        data_type: varchar
        description: a surrogate key generated to our table with the format YYYYMMDD.

      - name: date_day
        data_type: date
        description:  Date of the record in a format YYYY-MM-DD.

      - name: prior_date_day
        data_type: date
        description: Prior date of the record.

      - name: next_date_day
        data_type: date
        description: Next date of the record.

      - name: prior_year_date_day
        data_type: date
        description: Date from the prior year.

      - name: prior_year_over_year_date_day
        data_type: date
        description: Date from the prior year compared to the current year.

      - name: day_of_week
        data_type: number
        description: Numeric representation of the day of the week.

      - name: day_of_week_iso
        data_type: number
        description: ISO numeric representation of the day of the week.

      - name: day_of_week_name
        data_type: varchar
        description: Full name of the day of the week.

      - name: day_of_week_name_short
        data_type: varchar
        description: Short name of the day of the week.

      - name: day_of_month
        data_type: number
        description: Day of the month.

      - name: day_of_year
        data_type: number
        description: Day of the year.

      - name: week_start_date
        data_type: date
        description: Start date of the week.

      - name: week_end_date
        data_type: date
        description: End date of the week.

      - name: prior_year_week_start_date
        data_type: date
        description: Start date of the week from the prior year.

      - name: prior_year_week_end_date
        data_type: date
        description: End date of the week from the prior year.

      - name: week_of_year
        data_type: number
        description: Week number of the year.

      - name: iso_week_start_date
        data_type: date
        description: Start date of the ISO week.

      - name: iso_week_end_date
        data_type: date
        description: End date of the ISO week.

      - name: prior_year_iso_week_start_date
        data_type: date
        description: Start date of the ISO week from the prior year.

      - name: prior_year_iso_week_end_date
        data_type: date
        description: End date of the ISO week from the prior year.

      - name: iso_week_of_year
        data_type: number
        description: ISO week number of the year

      - name: prior_year_week_of_year
        data_type: number
        description: Week number of the prior year.

      - name: prior_year_iso_week_of_year
        data_type: number
        description: ISO week number of the prior year.

      - name: month_of_year
        data_type: number
        description: Month number of the year.

      - name: month_name
        data_type: varchar
        description: Full name of the month.

      - name: month_name_short
        data_type: varchar
        description: Short name of the month.

      - name: month_start_date
        data_type: date
        description: Start date of the month.

      - name: month_end_date
        data_type: date
        description: End date of the month.

      - name: prior_year_month_start_date
        data_type: date
        description: Start date of the month from the prior year.

      - name: prior_year_month_end_date
        data_type: date
        description: End date of the month from the prior year.

      - name: quarter_of_year
        data_type: number
        description: Quarter number of the year.

      - name: quarter_start_date
        data_type: date
        description: Start date of the quarter.

      - name: quarter_end_date
        data_type: date
        description: End date of the quarter.

      - name: year_number
        data_type: number
        description: Year number.

      - name: year_start_date
        data_type: date
        description: Start date of the year.

      - name: year_end_date
        data_type: date
        description: End date of the year.



  - name: dim_addresses
    description: a dimensional table who shows living addresses from the users/customers, and also the shipping address for orders.
    columns:
      - name: address_sk
        data_type: varchar
        description: a surrogate key generated to our table through "address_id".
        tests:
          - unique
          - not_null

      - name: address_id
        data_type: varchar
        description: a primary key from the source database.
        tests:
          - unique
          - not_null

      - name: country
        data_type: varchar
        description: the country where an address is located.

      - name: state
        data_type: varchar
        description: the state where an address is located.

      - name: zipcode
        data_type: varchar
        description: the zipcode where an address is located.

      - name: address
        data_type: varchar
        description: the address (street, number, apartment_no,...).


   
  - name: dim_customers
    description: a dimensional table who shows the information of our users.
    columns:
      - name: date_key
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_dates".
        tests:
          - relationships:
              to: ref('dim_date')
              field: date_key

      - name: user_sk
        data_type: varchar
        description: a surrogate key generated to our table through "user_id". 

      - name: user_id
        data_type: varchar
        description: a primary key from the source database.

      - name: address_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_dates".
        tests:
          - relationships:
              to: ref('dim_addresses')
              field: address_sk

      - name: full_name
        data_type: varchar
        description: Full name of the user (concat first_name and last_name).

      - name: email
        data_type: varchar
        description: Email address of the user.

      - name: phone_number
        data_type: varchar
        description: Phone number of the user.

      - name: created_at_utc
        data_type: timestamp_ltz
        description: Timestamp indicating when the user was created, in UTC.

      - name: updated_at_utc
        data_type: timestamp_ltz
        description: Timestamp indicating when the record was last updated, in UTC.


  - name: dim_event_types
    description: a dimensional table who shows the types of events on our website.
    columns:
      - name: event_types_sk
        data_type: varchar
        description: a surrogate key generated to our table through "event_type".

      - name: event_type
        data_type: varchar
        description: the type of the event_id (e.g., 'page_view', 'add-to-cart', 'checkout', 'package_shipped').
        tests:
          - accepted_values:
              values: ['page_view', 'add_to_cart', 'checkout', 'package_shipped']
          - not_null


  - name: dim_products
    description: a dimensional table who shows the information of our products.
    columns:
      - name: product_sk
        data_type: varchar
        description: a surrogate key generated to our table through "product_id".
        tests:
          - unique
          - not_null

      - name: product_id
        data_type: varchar
        description: a primary key from the source database.
        tests:
          - unique
          - not_null

      - name: product_name
        data_type: varchar
        description: Name of the product.
        tests:
          - not_null

      - name: unit_price_usd
        data_type: number
        description: Unit price of the product in USD.
        tests:
          - not_null
          - positive_values

      - name: inventory
        data_type: number
        description: Quantity of the product in inventory.
        tests:
          - not_null



  - name: dim_promos
    description: a dimensional table who shows the information of our promotions.
    columns:
      - name: promo_sk
        data_type: varchar
        description: a surrogate key generated to our table through "promo_id".
        tests:
          - unique
          - not_null

      - name: promo_id
        data_type: varchar
        description: a primary key from the source database.
        tests:
          - unique
          - not_null

      - name: promo_discount_percent
        data_type: float
        description: the percentage of discount of a promotion.
        tests:
          - not_null
          - positive_values

      - name: discount_unit
        data_type: float
        description: the decimal value of a discount of a promotion (promo_discount_percent/100).
        tests:
          - not_null
          - positive_values

      - name: promo_status
        data_type: varchar
        description: the status of a promotion.
        tests:
          - not_null
          - accepted_values:
              values: ['active','inactive']


  - name: dim_sales_orders
    description: a dimensional table who shows the information of the orders (1 row per order).
    columns:
      - name: order_sk
        data_type: varchar
        description: a surrogate key generated to our table through "order_id". 

      - name: order_id
        data_type: varchar
        description: a primary key from the source database.

      - name: date_key
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_dates".
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date_key


      - name: user_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_customers".
        tests:
          - not_null
          - relationships:
              to: ref('dim_customers')
              field: user_sk

      - name: address_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_addresses".
        tests:
          - not_null
          - relationships:
              to: ref('dim_addresses')
              field: address_sk

      - name: promo_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_promos".
        tests:
          - not_null
          - relationships:
              to: ref('dim_promos')
              field: promo_sk

      - name: status
        data_type: varchar
        description: Status of the order.
        tests:
          - not_null
          - accepted_values:
              values: ['no_status','preparing','shipped','delivered']

      - name: tracking_id
        data_type: varchar
        description: Identifier for order tracking.

      - name: shipping_service_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_shipping_service".
        tests:
          - not_null
          - relationships:
              to: ref('dim_shipping_service')
              field: shipping_service_sk
        

      - name: created_at_utc
        data_type: timestamp_ltz
        description: Timestamp indicating when the order was created in Coordinated Universal Time (UTC).
        tests:
          - not_null

      - name: estimated_delivery_at_utc
        data_type: timestamp_ntz
        description: Estimated delivery timestamp in Coordinated Universal Time (UTC) of an order.

      - name: delivered_at_utc
        data_type: timestamp_ntz
        description: Estimated delivery timestamp in Coordinated Universal Time (UTC).


  - name: dim_shipping_service
    description: a dimensional table who shows a list of the shipping companies.
    columns:
      - name: shipping_service_sk
        data_type: varchar
        description: a surrogate key generated to our table through "shipping_service". 
        tests:
          - unique
          - not_null
          
      - name: shipping_service
        data_type: varchar
        description: the name of the shipping company.


  - name: dim_state
    description: a dimensional table who shows a unique list of the states presented in our addresses history.
    columns:
      - name: state_sk
        data_type: varchar
        description: a surrogate key generated to our table through "state". 

      - name: state
        data_type: varchar
        description: the name of the state.



  - name: fact_budget
    description: ""
    columns:
      - name: budget_sk
        data_type: varchar
        description: a surrogate key generated to the table through "_row" column. 

      - name: product_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_products".
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_sk

      - name: target_quantity
        data_type: number
        description: the target quantity the company must reach on a certain month for a given product.

      - name: date_key
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_dates".
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date_key



  - name: fact_events
    description: fact table who consists of the measurements and metrics of the online user behaviour.
    columns:
      - name: event_id
        data_type: varchar
        description: a primary key from the source database. Each 'action' of the user has a unique event_id.
        tests:
          - unique
          - not_null

      - name: session_id
        data_type: varchar
        description: identifier of session. A user in 1 session can interact in many ways (several event_id's).
        tests:
          - not_null

      - name: event_types_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_event_types".
        tests:
          - not_null
          - relationships:
              to: ref('dim_event_types')
              field: event_types_sk

      - name: event_type
        data_type: varchar
        description: a descriptive of an event_id. Actions performed by the user.
        tests:
          - accepted_values:
              values: ['page_view', 'add_to_cart', 'checkout', 'package_shipped']
          - not_null

      - name: product_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_products".
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_sk

      - name: order_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_sales_orders".
        tests:
          - not_null
          - relationships:
              to: ref('dim_sales_orders')
              field: order_sk

      - name: date_key
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_date".
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date_key

      - name: created_at_utc
        data_type: timestamp
        description: timestamp indicating when the event was created (hour,minute,second).

      - name: page_url
        data_type: varchar
        description: the page url visit by the user.



  - name: fact_sales_orders_details
    description: fact table who consists of the measurements and metrics of the purchase (order) made by a customer.
    columns:
      - name: order_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_sales_orders".
        tests:
          - not_null
          - relationships:
              to: ref('dim_sales_orders')
              field: order_sk

      - name: product_sk
        data_type: varchar
        description: a foreigh key to connect this table with the table "dim_products".
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_sk

      - name: quantity_sold
        data_type: number
        description: the quantity of a certain product sold (inside a order).
        tests:
          - not_null
          - positive_values

      - name: unit_price_usd
        data_type: number
        description: unit price of a product.  
        tests:
          - not_null
          - positive_values

      - name: discount_usd
        data_type: float
        description: discount amount in usd.
        tests:
          - not_null
          - positive_values

      - name: gross_sales_usd
        data_type: number
        description: gross value of a sale (equal to quantity_sold * unit_price_usd)
        tests:
          - not_null
          - positive_values

      - name: discount_amount_usd
        data_type: number
        description: extended discount amount of a line order. Equal to (discount_usd/100) * (quantity_sold*unit_price_usd)
        tests:
          - not_null
          - positive_values

      - name: shipping_cost_usd
        data_type: number
        description: weighted shipping_cost in usd per line of product in a given order.
        tests:
          - not_null
          - positive_values

      - name: net_sales_amout
        data_type: number
        description: net sales in usd Equal to (gross_sales_usd - discount_amount_usd + shipping_cost_usd).
        tests:
          - not_null
          - positive_values

      - name: days_to_deliver
        data_type: number
        description: if the order was deliver, the metric calculate the number of days since the order's creation until the delivered date.

      - name: deliver_precision_days
        data_type: number
        description: when a order is shipped to the customer, an estimated date for deliver is created. This metric compares the precison of the estimated deliver date with the actual date of the order deliver.